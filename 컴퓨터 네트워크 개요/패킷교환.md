# 패킷교환
![네트워크 설정 정보](https://github.com/secgyu/Computer-Networking/blob/main/%ED%8C%A8%ED%82%B7%EA%B5%90%ED%99%98.png
)
종단 시스템들은 서로 `메시지(message)`를 교환한다. (**출발지 종단 시스템에서 목적지 종단 시스템으로** 메시지를 보냄)


1. 송신 시스템은 메시지를 `패킷(packet)`이라고 하는 작은 데이터 덩어리로 분할한다.


2. 각 패킷은 `통신 링크(communication link)`와 `패킷 스위치(packet switch)`를 거치게 된다.
    - 패킷 스위치에는 <b>라우터(router)</b>와 <b>링크 계층 스위치(link-layer switch)</b>의 두 가지 유형이 존재한다.


3. 패킷은 **링크의 최대 전송률과 같은 속도로** 각각의 통신 링크에서 전송된다.
    - 출발지 종단 시스템 혹은 패킷 스위치가 `R bps(bits per second)`의 속도로 링크에서 `L 비트`의 패킷을 송신한다면,  
      그 패킷을 전송하는 데 걸리는 시간은 `L/R 초`
    - 발신지와 목적지 사이에 N개 링크(각 링크속도는 R bps)가 있는 경우(즉 라우터 개수 N-1개), 1개 패킷 전송시간은 → `N x L/R`

## 저장-후-전달 전송(store-and-forward transmission) 방식

- 스위치가 패킷의 첫 비트를 출력 링크로 전송하기 전에 **전체 패킷**을 받아야 한다.
`저장-후-전달 전송 방식`은 대부분의 패킷 스위치가 이용하는 방식이다.
1. 패킷의 비트를 먼저 `저장(buffer, 즉 ‘store’)`한다.
2. **라우터가 패킷의 모든 비트를 수신하였다면** 그제서야 출력 링크로 그 패킷을 `전송(transmit, 즉 ‘forward’)`하기 시작한다.



## 예제 문제 1
![네트워크 설정 정보](https://github.com/secgyu/Computer-Networking/blob/main/%EB%AC%B8%EC%A0%9C1.png)
```
호스트 A와 호스트 B 사이에 4개 라우터가 존재하며, 모든 링크의 전송 속도는 10Mbps입니다.
호스트 A에서 호스트 B로 1KB(킬로바이트) 크기의 패킷 1개를 전송하는데 요구되는 전송 지연 시간은 몇 초입니까?
전송 지연을 제외한 다른 지연은 없다고 가정하고, M=10^6, k=10^3으로 가정하요.
```
### 계산 방법

- **패킷 하나의 전송 시간 계산**:
  - 전송 시간(Transmission Time) 당 링크 = L / R = 8,000 bits / 10,000,000 bps = 0.0008 seconds
  
- **전체 경로를 통한 전송 시간**:
  - 경로에는 4개의 라우터가 있으며, 이는 총 5개의 링크를 의미합니다.
  - 총 전송 시간(Total Transmission Time) = 5 * 0.0008 seconds = 0.004 seconds

이 계산은 각 링크를 통과하는데 필요한 시간만 고려한 것이며, 라우터에서의 처리 시간이나 대기 시간은 포함하지 않았습니다. 이는 최소 전송 시간을 나타냅니다.

### 참고:
- **L**은 패킷 크기를 나타내며 단위는 비트(bits)입니다.
- **R**은 링크의 전송 속도를 나타내며 단위는 비트 퍼 세컨드(bps, bits per second)입니다.



## 큐잉 지연(queuing delay)과 패킷 손실

- 각 패킷 스위치는 접속된 여러 `링크`를 가지고 있으며, 패킷 스위치는 **각 링크에 대해** `출력 버퍼`**를 가지고 있다.**
- 출력 버퍼(Output-Buffer)는 출력 큐(Output-Queue)로도 불리며, **그 링크로 송신하려고 하는 패킷을 저장하고 있다.**  
  이는 `패킷 교환`에서 중요한 역할을 한다.
- 큐잉지연(Queuing delay)  
  -해당 출력링크가 다른 패킷전송중이면 도착하는 패킷은 버퍼에서 대기해야함
패킷이 겪는 지연은 앞에서 보았던 저장-후-전달 지연만 존재하는 것이 아니다.  
  -큐잉지연은 네트워크 혼잡도에 따라 가변적임  
  -버퍼크기 유한하므로 버퍼가 가득 찬 상태에서 새로운 패킷이 출력버퍼에 도착하면 패킷손실 발생
   - 도착한 패킷 혹은 이미 큐에 대기 중인 패킷을 폐기

<br/>

## 포워딩 테이블과 라우팅 프로토콜

> 라우터는 접속된 통신 링크 중 하나로 도착하는 패킷을 받아, **접속된 통신 링크 중 다른 링크로 그 패킷을 전달한다.**

<br/>

### IP 주소

- 인터넷에서 모든 종단 시스템은 IP 주소를 가지며, 이 주소는 계층적 구조를 갖는다.
- 출발지 종단 시스템이 목적이 종단 시스템으로 패킷을 보내고자 할 때 **출발지는 패킷의 헤더에 목적지의 IP 주소를 포함한다.**

<br/>

### 포워딩 테이블(forwarding table)

각 라우터는 **목적지 주소 또는 목적지 주소의 일부를 라우터의 출력 링크로 매핑**하는 포워딩 테이블을 가지고 있다.

따라서 라우터가 수신한 패킷을 어느 링크로 전달해야 하는지를 결정하는 과정은 다음과 같다.

1. 패킷이 라우터에 도착한다.
2. 라우터는 패킷의 IP 주소를 조사한다.
3. 해당 목적지 주소를 이용하여 포워딩 테이블을 검색한다.
4. 그 패킷을 출력 링크로 보낸다.

<br/>

### 라우팅 프로토콜(routing protocol)

그렇다면 포워딩 테이블은 어떻게 설정되는 것일까? *(5장에서 자세히 논의)*

인터넷은 **자동으로 포워딩 테이블을 설정하는 데 이용되는** 여러 특별한 라우팅 프로토콜을 가지고 있다.
