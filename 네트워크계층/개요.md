# 🌐 네트워크 계층

## 📘 네트워크 계층 개요
### 네트워크 계층
- **Network edge vs. core**
  - 애플리케이션 계층, 트랜스포트 계층: network edge
  - 네트워크 계층: network core
- **라우팅 (routing)**
  - 송신 측에서 목적지까지 패킷이 전송될 경로를 결정하는 것

- **포워딩 (forwarding)**
  - 라우터에서 입력 링크로부터 패킷을 출력 링크로 전달하는 것
  - 각 라우터는 포워딩 테이블을 유지

### 포워딩 테이블
- **포워딩 테이블**
  - 목적지 주소를 (출력) 링크 인터페이스에 대응시킨 테이블
- **예시**
```plaintext
헤더값 출력링크
0100 3
0101 2
0111 2
1001 1
```
- **포워딩 예시**
```plaintext
Network address/mask Next-hop Interface
10.70.65.192/26 - 2
10.70.65.128/25 - 0
10.70.22.0/24 - 3
10.70.16.0/22 - 1
Default 10.70.65.200 2
```


## 📜 인터넷 프로토콜: IP
### IP 데이터그램 형식
- **IPv4 데이터그램 형식**

| 필드              | 설명                                                      |
|-------------------|-----------------------------------------------------------|
| 버전              | 헤더의 IP 버전을 나타냄 (IPv4: 4)                          |
| 헤더길이          | 헤더 길이를 4바이트 단위로 나타냄 (5~15: 20~60바이트)      |
| 서비스타입 (TOS)  | 다양한 타입의 서비스 품질을 지정                           |
| 데이터그램 길이    | 헤더와 데이터를 포함한 전체 데이터그램 길이 (최대 65535바이트) |
| 식별자            | 데이터그램의 고유 식별자                                    |
| 플래그            | 단편화 및 재조립에 대한 제어 플래그                         |
| 단편화 오프셋     | 단편화된 데이터의 원래 위치를 나타냄                        |
| TTL               | 데이터그램의 생존 시간 (네트워크 홉 수)                     |
| 프로토콜          | 상위 계층 프로토콜을 식별 (예: ICMP, TCP, UDP)              |
| 헤더 체크섬       | 헤더의 무결성 검사를 위한 체크섬 값                        |
| 출발지 IP 주소     | 데이터그램의 출발지 주소                                    |
| 목적지 IP 주소     | 데이터그램의 목적지 주소                                    |
| 옵션              | 선택적 확장 정보                                           |
| 데이터 (Payload)  | 상위 계층 프로토콜의 데이터 (TCP, UDP, ICMP 등)             |

### 필드 설명
- **버전 (4비트)**: IP 프로토콜 버전 명시 (IPv4: 4)
- **헤더길이 (4비트)**: IP 헤더 길이를 4바이트 단위로 명시 (5~15: 20~60바이트)
- **서비스타입 (TOS)**: 다양한 타입의 IP 데이터그램 허용
- **데이터그램 길이**: 헤더와 데이터를 포함한 전체 데이터그램 길이 (최대 65535바이트)
- **식별자, 플래그, 단편 오프셋**: IP 단편화 관련 필드들
- **TTL (Time-To-Live)**: 데이터그램이 네트워크에서 순환하지 않도록 방지
- **프로토콜 (Protocol)**: 상위 계층 프로토콜 명시 (예: ICMP, TCP, UDP)
- **헤더 체크섬**: 헤더에 대한 16비트 체크섬 필드로, 비트 오류 검출에 사용
- **출발지 IP 주소, 목적지 IP 주소**: 데이터그램 생성 시 설정
- **옵션**: IP 헤더 확장
- **데이터 (Payload)**: TCP, UDP, ICMP 등의 데이터 저장

### IP 데이터그램 단편화
- **단편화**: IP 데이터그램은 링크 계층 프레임으로 캡슐화되기 위해 단편화될 수 있음
- **식별자**: 송신 호스트는 각 데이터그램을 보낼 때마다 식별자 부착
- **플래그 비트들**: DF 비트, MF 비트
- **오프셋**: 현재 데이터그램 내 페이로드 첫 바이트의 상대적 위치를 8의 배수 단위로 표현
- **재조립 실패 시 데이터그램 폐기**

### IPv4 주소체계
- **인터페이스**: 네트워크 장치와 물리적 링크 사이의 경계
- **IP 주소**: 32비트 길이, 십진 표기법 사용 (예: 10.128.25.3)

### 서브넷
- **서브넷 (Subnet)**: 전체 IP 네트워크를 구성하는 부분 네트워크
- **서브넷 마스크**: 서브넷 주소와 브로드캐스트 주소 계산에 사용
- **예시**: 192.168.130.0/24
