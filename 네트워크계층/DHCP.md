# 📜 DHCP (Dynamic Host Configuration Protocol)

## 개요
DHCP(Dynamic Host Configuration Protocol)는 네트워크 관리 프로토콜로, IP 주소와 기타 네트워크 구성 정보를 자동으로 할당하여, 클라이언트가 네트워크에 연결되었을 때 필요한 설정을 자동으로 제공해줍니다. 이를 통해 네트워크 관리자는 수동으로 IP 주소를 설정하지 않고도 많은 장치를 효율적으로 관리할 수 있습니다.

## DHCP 동작 과정
DHCP는 기본적으로 네 가지 단계로 구성됩니다: DHCP DISCOVER, DHCP OFFER, DHCP REQUEST, DHCP ACK.

### 1. DHCP DISCOVER
- **클라이언트**: 네트워크에 연결된 후, 자신에게 IP 주소를 할당받기 위해 브로드캐스트 메시지(DHCPDISCOVER)를 전송합니다.
- **메시지 내용**: 클라이언트의 MAC 주소, 필요한 구성 정보

### 2. DHCP OFFER
- **DHCP 서버**: DHCPDISCOVER 메시지를 수신한 후, 사용 가능한 IP 주소와 기타 구성 정보를 포함한 DHCPOFFER 메시지를 클라이언트에게 브로드캐스트로 전송합니다.
- **메시지 내용**: 제안된 IP 주소, 서브넷 마스크, 디폴트 게이트웨이, DNS 서버 등

### 3. DHCP REQUEST
- **클라이언트**: 여러 DHCP 서버로부터 DHCPOFFER 메시지를 받을 수 있으므로, 그 중 하나를 선택하여 DHCPREQUEST 메시지를 브로드캐스트로 전송합니다. 이 메시지는 선택된 서버와 할당받은 IP 주소를 명시합니다.
- **메시지 내용**: 선택된 DHCP 서버의 IP 주소, 요청된 IP 주소

### 4. DHCP ACK
- **DHCP 서버**: 클라이언트의 DHCPREQUEST 메시지를 수신한 후, IP 주소 할당을 확인하는 DHCPACK 메시지를 전송합니다. 이로써 클라이언트는 네트워크 설정을 완료하고 IP 주소를 사용할 수 있게 됩니다.
- **메시지 내용**: 최종적으로 할당된 IP 주소, 임대 기간, 기타 구성 정보

```plaintext
DHCP 동작 과정

클라이언트                  DHCP 서버
  |                        |
  | DHCPDISCOVER          |
  |----------------------->|
  |                        |
  |    DHCPOFFER           |
  |<-----------------------|
  |                        |
  | DHCPREQUEST            |
  |----------------------->|
  |                        |
  |    DHCPACK             |
  |<-----------------------|
  |                        |
```

## DHCP 메시지 형식
DHCP 메시지는 고정된 형식으로 전송되며, 다음과 같은 필드로 구성됩니다:
- **OP**: 메시지 유형 (1 = 요청, 2 = 응답)
- **htype**: 하드웨어 유형 (예: 이더넷은 1)
- **hlen**: 하드웨어 주소 길이 (예: 이더넷 주소는 6)
- **hops**: 릴레이 에이전트가 사용하는 홉 카운터
- **xid**: 트랜잭션 ID, 클라이언트의 요청과 응답을 매칭하는 데 사용
- **secs**: 클라이언트가 요청을 시작한 이후 경과된 시간
- **flags**: 플래그 필드 (브로드캐스트 플래그 포함)
- **ciaddr**: 클라이언트 IP 주소 (클라이언트가 이미 IP를 가지고 있을 때 사용)
- **yiaddr**: 'Your' IP 주소, 클라이언트에게 할당된 IP 주소
- **siaddr**: 서버 IP 주소, 다음에 부트스트랩을 다운로드할 서버의 주소
- **giaddr**: 게이트웨이 IP 주소, 릴레이 에이전트의 주소
- **chaddr**: 클라이언트 하드웨어 주소 (MAC 주소)
- **sname**: 서버 이름, 옵션 (DHCP 서버의 호스트 이름)
- **file**: 부트스트랩 파일 이름, 옵션 (부팅 시 다운로드할 파일 경로)
- **options**: 옵션 필드, DHCP 옵션 (예: 서브넷 마스크, 라우터, DNS 등)

## DHCP 옵션 필드
DHCP 옵션 필드는 클라이언트에게 추가적인 구성 정보를 제공합니다. 주요 옵션은 다음과 같습니다:
- **서브넷 마스크 (Option 1)** : 클라이언트에게 할당된 서브넷 마스크
- **라우터 (Option 3)** : 클라이언트의 기본 게이트웨이 IP 주소
- **DNS 서버 (Option 6)** : 클라이언트가 사용할 DNS 서버의 IP 주소
- **도메인 이름 (Option 15)** : 클라이언트의 도메인 이름
- **임대 기간 (Option 51)** : 클라이언트에게 할당된 IP 주소의 임대 기간
- **DHCP 메시지 유형 (Option 53)** : DHCP 메시지의 유형 (DISCOVER, OFFER, REQUEST, ACK 등)

## DHCP 임대 과정
DHCP를 통해 할당된 IP 주소는 영구적이지 않으며, 임대 기간이 있습니다. 클라이언트는 임대 기간이 만료되기 전에 IP 주소를 갱신해야 합니다.

### IP 주소 갱신 과정
1. **T1 타이머 (임대 기간의 50%)** : 클라이언트는 DHCPREQUEST 메시지를 전송하여 IP 주소를 갱신합니다.
2. **T2 타이머 (임대 기간의 87.5%)** : 클라이언트가 T1 갱신 시도에 실패한 경우, DHCPREQUEST 메시지를 브로드캐스트로 전송하여 모든 DHCP 서버에 갱신 요청을 보냅니다.
3. **임대 기간 만료** : 클라이언트가 T2 갱신 시도에 실패하면, IP 주소 임대가 만료되고 더 이상 사용할 수 없습니다.

## DHCP 릴레이 에이전트
DHCP 서버와 클라이언트가 다른 네트워크 세그먼트에 있을 때, DHCPDISCOVER 메시지를 DHCP 서버에 전달하는 역할을 합니다.
- **릴레이 에이전트** : DHCPDISCOVER 메시지를 수신하여 해당 메시지를 DHCP 서버로 전달하고, DHCP 서버의 응답을 클라이언트에게 전달합니다.
